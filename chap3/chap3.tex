\chapter[Background]{Background}
\label{chap:chap3}
\section{Fluids}

A {\em fluid}, formally speaking, is a substance that continuously deforms under the application of shear stress. \todo{citation}. More intuitively, it is a substance that {\em flows}. Although colloquially we may use the term fluid to refer only to liquids, gases can exhibit flow, and are therefore considered to be fluids as well. (Indeed, the results demonstrated in this dissertation focus entirely on the turbulent flow of smoke.) The natural world is full of captivating fluid motions: ocean waves, ripples in a pond, clouds, the steam of a teakettle, etc. These flowing patterns, while beautiful, appear difficult to formalize precisely, and the modeling of fluids continues to be a mathematical and computational challenge to this day.

\section{Physics-based modeling}
The field of {\em fluid dynamics} in physics seeks to model and describe fluid flow systematically according to equations generated from a set of basic assumptions and principles. In order for continuous mathematical operators to be used to describe fluids, one of the basic assumptions is that of the {\em continuum}: for mathematical purposes, we assume that fluid velocity varies continuously across space, even though in reality, fluids are actually composed of discrete molecules. TBesides this continuum assumption, the various conservation laws of mass, energy, and momentum, imply the famous Navier-Stokes equations, which describe the velocity field $\uu$ of fluid flow depending on the intrinsic stress of viscosity and pressure. In the case where we make the additional simplifying assumption that the fluid is incompressible,\footnote{i.e., the fluid density does not vary within the flow field} the equations take the following form:

\begin{equation}
\label{eq:incompress}
\nabla \cdot \uu = 0
\end{equation}
\begin{equation}
\label{eq:momentum}
\frac{\partial \uu}{\partial t} = -\left(\uu \cdot \nabla \right)\uu + \nu \nabla^{2}\uu - \nabla{p} + \mathbf{f}_e
\end{equation}

There are several terms here that must be unpacked:

\begin{itemize}
\item The time-varying vector field $\uu = u(\xx, t)$ describes the fluid velocity field. It is the main quantity we are interested in, and solving these differential equations amounts to figuring out what $\uu$ is for all times $t$.
\item The constant $\nu$ represents the viscosity of the fluid, which represents its resistance to deform while flowing. (Intuitively, this can be thought of its resistance to being stirred: molasses, for instance, has higher viscosity than water.) 
\item The time-varying scalar field $p = p(\xx, t)\ $ represents the pressure field of the fluid. 
\item The time-varying vector field $\mathbf{f}_e = \mathbf{f}_e(\xx, t)$ represents any external forces affecting the fluid, such as gravity.
\end{itemize}
Equation \ref{eq:incompress} enforces the assumption of incompressibility, while equation \ref{eq:momentum} is a consequence of the aforementioned conservation laws.

\section{Simulation}

Simulation is, of course, the imitation of a natural process, in this case over time. Any simulation must first determine a technique of modeling the process computationally, and there are often many different possible strategies. We consider here a few typical approaches in computational fluid dynamics.

One of the most direct ways of modeling fluids is to discretize both the spatial and time domain. In other words, to perform the calculations, we dice up the region of space into a regular grid of small cubical cells. Each cell then contains a vector, or arrow, describing the velocity of the fluid at the position in space. In order to evolve the motion of the flow over time, we also dice up time itself into a sequence of discrete time steps, computing how the velocity of the fluid in each cell changes at each time step. This approach is called the {\em Eulerian} viewpoint of the flow. Intuitively, this can be thought of as staying in a fixed location and observing the flow through that particular location. More precisely, the fluid's velocity in this viewpoint is represented as $\uu(\xx, t)$, which gives the velocity of the fluid at each spatial location $\xx$ and time $t$.

In contrast, the {\em Lagrangian} viewpoint of the flow takes the point of view of each individual fluid particle as it moves along the flow through space and time. Intuitively, this can be thought of drifting along with the flow. If we label each particle based on its position in space using a vector field $\mathbf{r}$, we then describe the fluid flow with the position field $\mathbf{X}(\mathbf{r}, t)$ , which gives the position of each particle labeled by $\mathbf{r}$ at time $t$.

We can connect these two viewpoints with the following equation:
\begin{equation}
\label{eq:euler-lagrange}
\uu\left(\mathbf{X}\left(\mathbf{r}, t\right)\right) = \frac{\partial \mathbf{X}}{\partial t}\left(\mathbf{r}, t\right)
\end{equation}

The left-hand side of equation \ref{eq:euler-lagrange} describes the velocity of the flow at position $\mathbf{r}$ and time $t$ using the Eulerian-specified velocity field $\uu$, while the right-hand side describes the same velocity by taking the partial derivative of the Lagrangian specified position field $\mathbf{X}$.

Given an Eulerian-specified fluid velocity field $\uu(\xx, t)$ over a domain of space, and given another Eulerian-specified scalar field $\varphi(\xx, t)$ (e.g., temperature) over the same domain, we can consider the total derivative of $\varphi$. By the chain rule, this expands as follows:

\begin{equation}
\frac{\mathrm{d}}{\mathrm{d}t}\varphi\left(\xx, t\right) = \frac{\partial \varphi}{\partial t} + \dot{\xx} \cdot \nabla \varphi
\end{equation}

The partial derivative term $\frac{\partial \varphi}{\partial t}$ indicates the instantaneous rate at which the temperature is changing with time, holding the spatial position constant. Thus, if we imagine a fluid flow being comprised of many infinitesimal particles, this term represents any change in temperature of a particle at a fixed spatial location. The remaining term $\dot{\xx} \cdot \nabla \varphi$ describes a more dynamic rate of change, as it incorporates changes in temperature caused by moving {\em along} the flow through the path $\dot{\xx}$. This movement is in the Lagrangian spirit of drifting along with the flow. In the case where $\dot{x}$ is taken to align with the flow velocity $\uu$, we have 

\begin{equation}
\frac{\mathrm{d}}{\mathrm{d}t}\varphi\left(\xx, t\right) = \frac{\partial \varphi}{\partial t} + \uu \cdot \nabla \varphi
\end{equation}
which is often called the {\em material derivative}. The operator $\uu \cdot \nabla$ is the advection operator, which we will be prominent later on.

\section{Subspace Methods}
Subspace methods, also known as model reduction, or reduced order methods, has a long history in engineering and applied mathematics, including applications to fluid simulation \cite{lumley1967}, and was introduced to the computer graphics literature in 1989 by Pentland and Williams \cite{Pentland:1989:GVM, Berkooz93theproper}. The basic principle of these methods, as the name suggests, is to reduce the computational complexity of a large numerical simulation. A typical simulation will have many degrees of freedom in principle, generating a vast state space of possibilities. However, in practice, not all of these degrees of freedom are of equal importance. By systematically discovering a reduced subspace of the state space, and carrying out calculations within this subspace, a subspace simulation can lead to large computational accelerations with minimal degradation of accuracy.

\subsection{Modal Analysis}
To see an example of the subspace method in action, consider the modeling of small deformations of rigid bodies. Although rigid bodies in principle have many degrees of freedom over which they can deform, they have certain characteristic shapes into which they are more likely to deform. These shapes, also known as {\em modes}, are the ones which minimize the strain, and in an intuitive sense are the ``natural'' deformations of the rigid body. To compute these, we assume the rigid body is discretized into a mesh with $N$ vertices. We then compute the system mass and stiffness matrices $\MM \in \R^{3N \times 3N}$ and $\KK \in \R^{3N \times 3N}$, respectively. The modes then satisfy the generalized eigenvalue equation

\begin{equation}
	\KK \xx = \lambda \MM \xx
\end{equation}

Due to the special properties of the matrices $\MM$ and $\KK$, which are both symmetric positive-definite (SPD), the eigenvalues $\lambda_i$ are positive real numbers. 
Although there are $3N$ eigenvalues in total, in practice, we can take a subset of them, $\lambda_1, \lambda_2, \dots, \lambda_r$, from least to greatest, and their associated eigenvectors
 $\psi_1, \psi_2, \dots, \psi_r$. (Here, $r \ll 3N$ represents the number of modes we wish to retain.) The eigenvectors $\psi_i$ we choose corresponding to the eigenvalues $\lambda_i$ 
 are not unique; for convenience, we select those that satisfy the mass-orthogonality condition $\langle \MM \psi_i, \psi_j \rangle = \delta_{ij}$, where $\delta_{ij}$ is the Kronekcer delta, 
 equaling $0$ for $i \neq j$ and $1$ for $i=j$. The $r$-dimensional subspace $S \subset \R^{3N}$ formed by the linear span of these eigenvectors can be encapsulated in matrix form 
 by assembling the modal basis matrix $\UU \in \R^{3N \times r}$ as follows:

\begin{align}
	\UU^{T} &= \begin{pmatrix}
	\vertbar & \vertbar &   & \vertbar \\
	\psi_1 & \psi_2 & \dots & \psi_r   \\
	\vertbar & \vertbar &   & \vertbar
  \end{pmatrix}
\end{align}

Thus, the mass-orthogonality condition we specified for the modes can be captured in the more succinct matrix form $\UU^{T} \MM \UU = \II_r$,
where $\II_r \in \R^{r \times r}$ denotes the $r \times r$ identity matrix.

Now consider the typical equation of motion for undamped small deformations $\xx \in \R^{3N}$ corresponding to external forces $\ff \in \R^{3N}$: 
\begin{equation}
\label{eq:mass-spring}
\MM \ddot{\xx} + \KK \xx = \ff
\end{equation}

Equation \ref{eq:mass-spring}, is a very high-dimensional linear differential equation obtained by applying the standard equations of elastic deformation to the mesh with $3N$ nodes using the finite element method (FEM). For very fine meshes with large values of $N$, this equation may present a computational bottleneck. Hence, the approach of model reduction is welcome. We proceed by approximating $\xx$ as a linear combination of the modes $\psi_1, \dots, \psi_r$:

\begin{equation}
\xx \approx \UU \qq
\end{equation}
where the vector $\qq \in \R^{r}$ has components $q_i$ that are the corresponding weights of the associated modes $\psi_i$, $i=1,\dots,r$. This vector $\qq$ is called the {\em reduced coordinates} of $\xx$, and can also be thought of as the projection of $\xx$ into the subspace $S$. Rewriting equation \ref{eq:mass-spring}, we obtain

\begin{equation}
\MM {\UU \ddot{\qq}} + \KK \UU \qq = \ff
\end{equation}
By the generalized eigenvector condition, we have $\KK \UU = \Lambda \MM \UU$, where $\Lambda = \textnormal{diag}\left(\lambda_1, \dots, \lambda_r\right)$. Hence, we simplify as follows:

\begin{equation}
\MM \UU \left(\ddot{\qq} + \Lambda \qq\right) = \ff
\end{equation}
Next, to clear away the factor of $\MM \UU$, we pre-multiply both sides by $\UU^{T}$:

\begin{equation}
\UU^{T} \MM \UU \left(\ddot{\qq} + \Lambda \qq\right)= \UU^{T} \ff
\end{equation}
By the mass-orthogonality condition, the term $\UU^{T} \MM \UU$ reduces to $\II_r$.  On the right-hand-side, $\widetilde{\ff} = \UU^{T} \ff \in \R^r$ is the reduced form of $\ff$. Hence, we have the following lower-dimensional linear differential equation with unknown $\qq \in \R^{r}$:

\begin{equation}
\ddot{q} + \Lambda \qq = \widetilde{\ff}
\end{equation}
In this particular case, the system is uncoupled since $\Lambda$ is diagonal, so we have a collection of $r$ independent one-dimensional ordinary differential equations. These can be integrated forward in time very efficiently, obtaining $\qq_{t+1}$, the value of $\qq$ at the next time step. To finish the computation, we reconstruct into the full-dimensional space by computing $\xx_{t+1} = \UU \qq_{t+1}$.

\subsection{Sound generation}
Small rigid deformations of a solid body are precisely those that generate sound waves, so we briefly consider the application to audio of the previous discussion. Recall that our subspace reduction produces a collection of $r$ independent one-dimensional equations, which, expanded out, take the form

\begin{equation}
\label{eq:system}
\ddot{q_i} + \lambda_i q_i = \psi_i^{T} f_i, \ \ i = 1, \dots, r
\end{equation}

Recalling that each $\lambda_i$ is a positive real number, let $\omega_i$ be the positive square root $\omega_i = \sqrt{\lambda_i}$. Then the general analytical solution to the homogenous portion of each one-dimensional differential equation in \ref{eq:system} is given by $q_i = c_1 e^{i \omega_i t} + c_2 e^{i \omega_i t}$. In other words, we can think of the $i$-th mode as resonating at a natural frequency of $\omega_i$. This allows us to perform simple additive synthesis by mixing together a collection of sinusoids at the corresponding frequencies, generating the audio signal that corresponds to the physical deformation. The spirit of this basic approach motivates
our sonification process in Chapter \ref{chap:chap5}.